//
// WARNING: DO NOT EDIT THIS FILE
//   This file has been generated from the target's JSON hardware description
//

{% set ads_adcs = adc_inputs.adcs | selectattr('name', '==', 'EXT') | list %}
{% for ads in ads_adcs %}
#define MS_BETWEEN_CHANNEL {{ ads.sample_time }}
#define NUM_OF_ADS {{ ads.adc }}
static i2c_master_dev_handle_t ads[NUM_OF_ADS] = {0};
{% endfor %}

static const i2c_device_config_t i2c_dev_conf[NUM_OF_ADS] = {
  {% for ads in ads_adcs %}
  {% for i in range(ads.adc) %}
  {
    .device_address = ADS1X15_ADDRESS + {{ loop.index0 }},
    .scl_speed_hz = 400000,
  },
  {% endfor %}
  {% endfor %}
};

{% set main_inputs = adc_inputs.inputs | selectattr('type', '==', 'STICK') | list %}
{% set n_mains = main_inputs | count %}

{% set flex_offset = n_mains %}
{% set flex_inputs = adc_inputs.inputs | selectattr('type', '==', 'FLEX') | list %}
{% set n_flex = flex_inputs | count %}
static const ads1015_channel_t ads_channels[] = {
  {% for input in main_inputs %}
    { {{ input.channel }}, {{ input.pin }}, {{ loop.index0 }} },
  {% endfor %} 

  {% for input in flex_inputs %}
    { {{ input.channel }}, {{ input.pin }}, {{ flex_offset + loop.index0 }} },
  {% endfor %}

{% set vbat_offset = flex_offset + n_flex %}
{% set vbat_inputs = adc_inputs.inputs | selectattr('type', '==', 'VBAT') | list %}
{% set n_vbat = vbat_inputs | count %}
  {% for input in vbat_inputs %}
    { {{ input.channel }}, {{ input.pin }}, {{ vbat_offset + loop.index0 }} },
  {% endfor %}

{% set rtc_bat_offset = vbat_offset + n_vbat %}
{% set rtc_bat_inputs = adc_inputs.inputs | selectattr('type', '==', 'RTC_BAT') | list %}
{% set n_rtc_bat = rtc_bat_inputs | count %}
  {% for input in rtc_bat_inputs %}
    { {{ input.channel }}, {{ input.pin if input.pin != None else '0xFFFF' }}, {{ rtc_bat_offset + loop.index0 }} },
  {% endfor %}
};

